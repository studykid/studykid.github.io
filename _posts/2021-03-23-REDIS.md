## redis
能说说redis集群的原理吗？如果说依靠哨兵可以实现redis的⾼可⽤，如果还想在⽀持⾼并发同时容纳海量的数据，那就需要redis集
群。redis集群是redis提供的分布式数据存储⽅案，集群通过数据分⽚sharding来进⾏数据的共享，同
时提供复制和故障转移的功能。
节点
⼀个redis集群由多个节点node组成，⽽多个node之间通过cluster meet命令来进⾏连接，节点的握⼿
过程：
1. 节点A收到客户端的cluster meet命令
2. A根据收到的IP地址和端⼝号，向B发送⼀条meet消息
3. 节点B收到meet消息返回pong
4. A知道B收到了meet消息，返回⼀条ping消息，握⼿成功
5. 最后，节点A将会通过gossip协议把节点B的信息传播给集群中的其他节点，其他节点也将和B进⾏
握⼿
槽slot
redis通过集群分⽚的形式来保存数据，整个集群数据库被分为16384个slot，集群中的每个节点可以处
理0-16384个slot，当数据库16384个slot都有节点在处理时，集群处于上线状态，反之只要有⼀个slot没
有得到处理都会处理下线状态。通过cluster addslots命令可以将slot指派给对应节点处理。
slot是⼀个位数组，数组的⻓度是16384/8=2048，⽽数组的每⼀位⽤1表示被节点处理，0表示不处理，
如图所示的话表示A节点处理0-7的slot。
当客户端向节点发送命令，如果刚好找到slot属于当前节点，那么节点就执⾏命令，反之，则会返回⼀个
MOVED命令到客户端指引客户端转向正确的节点。（MOVED过程是⾃动的）如果增加或者移出节点，对于slot的重新分配也是⾮常⽅便的，redis提供了⼯具帮助实现slot的迁移，整
个过程是完全在线的，不需要停⽌服务。
故障转移
如果节点A向节点B发送ping消息，节点B没有在规定的时间内响应pong，那么节点A会标记节点B为pfail
疑似下线状态，同时把B的状态通过消息的形式发送给其他节点，如果超过半数以上的节点都标记B为
pfail状态，B就会被标记为fail下线状态，此时将会发⽣故障转移，优先从复制数据较多的从节点选择⼀
个成为主节点，并且接管下线节点的slot，整个过程和哨兵⾮常类似，都是基于Raft协议做选举。
